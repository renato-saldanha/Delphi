unit Model.Connections.DBExpress;

interface

uses
  Data.DB, System.SysUtils, Data.SqlExpr, Model.Connections.Interfaces,
  System.Classes, Vcl.DBCtrls, Vcl.DBGrids;


type
  TModelConnectionsFireDac = class(TInterfacedObject, IModelConnectionsGeneric)
  private
    FConnection: TSQLConnection;
    FQry: TSQLQuery;
    FDataSource: TDataSource;
    procedure ConnectionConfig;
  public
    constructor Create;
    destructor Destroy; override;
    class function New: IModelConnectionsGeneric;

    procedure Close;
    function Connection: TSQLConnection;
    function GetDataSet: TSQLQuery;
    function SQL: TStrings;
    function ParamByName(AValue: String) : TParam;
    function FieldByName(AValue: String) : TField;
    function Open: TDataset; overload;
    function Open(AValue: String): TDataset; overload;
    function DBNavigator(const ADBNavigator: TDBNavigator): IModelConnectionsGeneric;
    function DBGrid(const ADBGrid: TDBGrid): IModelConnectionsGeneric;
  end;

implementation

{ TModelConnectionsFireDac }

function TModelConnectionsFireDac.Connection: TSQLConnection;
begin
  Result := Self.FConnection;
end;

procedure TModelConnectionsFireDac.ConnectionConfig;
begin
  try
    FConnection.Connected             := False;
    FConnection.DriverName            := 'Firebird';
    FConnection.LoginPrompt           := False;
    FConnection.Params.Add('database=D:\Renato\ReactNative\AutRemotaBackEnd\DB\DB.FDB');
    FConnection.Params.Add('UserName=SYSDBA');
    FConnection.Params.Add('Password=masterkey');
    FConnection.Connected             := True;
  except on E: Exception do
    raise Exception.Create(E.Message);
  end;
end;

constructor TModelConnectionsFireDac.Create;
begin
  FConnection         := TSQLConnection.Create(nil);
  ConnectionConfig();
  FQry                := TSQLQuery.Create(FConnection);
  FQry.SQLConnection  := FConnection;
  FDataSource         := TDataSource.Create(FConnection);
  FDataSource.DataSet := FQry;
end;

destructor TModelConnectionsFireDac.Destroy;
begin
  inherited;
  FreeAndNil(FQry);
  FreeAndNil(FConnection);
end;

function TModelConnectionsFireDac.GetDataSet: TSQLQuery;
begin
  Result := FQry;
end;

class function TModelConnectionsFireDac.New: IModelConnectionsGeneric;
begin
  Result := Self.Create;
end;

function TModelConnectionsFireDac.Open: TDataSet;
begin
  FQry.Open;
  Result:= FQry;
end;

function TModelConnectionsFireDac.Open(AValue: String): TDataSet;
begin
  FQry.Close;
  FQry.SQL.Clear;
  FQry.SQL.Add(AValue);
  FQry.Open;
  Result:= FQry;
end;

procedure TModelConnectionsFireDac.Close;
begin
  FQry.Close;
end;

function TModelConnectionsFireDac.ParamByName(AValue: String) : TParam;
begin
  Result := FQry.ParamByName(AValue);
end;

function TModelConnectionsFireDac.FieldByName(AValue: String) : TField;
begin
  Result := FQry.FieldByName(AValue);
end;

function TModelConnectionsFireDac.SQL: TStrings;
begin
  Result := FQry.SQL;
end;

function TModelConnectionsFireDac.DBGrid(const ADBGrid: TDBGrid): IModelConnectionsGeneric;
begin
  Result := Self;
  ADBGrid.DataSource := FDataSource;
end;

function TModelConnectionsFireDac.DBNavigator(const ADBNavigator: TDBNavigator): IModelConnectionsGeneric;
begin
  Result := Self;
  ADBNavigator.DataSource:= FDataSource;
end;

end.

